sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/Dialog","sap/m/Button","sap/m/library","sap/m/Text","sap/m/MessageBox","sap/m/BusyDialog"],function(e,t,a,i,o,l,n){"use strict";var r=new sap.ui.model.odata.ODataModel("/sap/opu/odata/sap/ZISH_REMPE_SRV/");var s=i.ButtonType;var u=i.DialogType;return e.extend("autoregistromedico.controller.Main",{onInit:function(){sap.ui.core.BusyIndicator.show(0);this.f_loadSpecialities();this.f_loadFormModel()},f_loadSpecialities:function(){var e=this;r.read("/SpecialitiesSet",{success:function(t){e.getView().setModel(new sap.ui.model.json.JSONModel({SpecialitiesSet:t.results}),"DataModel")},error:function(e){}})},f_loadFormModel:function(){var e=this;r.read("/MedicalRegistrationSet?$expand=MedicalToSpecialityNAV",{success:function(t){var a=t.results[0].MedicalToSpecialityNAV.results;var i=[];a.forEach(e=>{i.push(e.Speciality)});var o=new sap.ui.model.json.JSONModel({IdCollegiate:t.results[0].IdCollegiate,Name:t.results[0].Name,Surname1:t.results[0].Surname1,Surname2:t.results[0].Surname2,PersonalId:t.results[0].PersonalId,Email:t.results[0].Email,Gender:t.results[0].Gender,Phone:t.results[0].Phone,PrescriberType:t.results[0].PrescriberType,Specialities:i});e.getView().setModel(o,"DataModel");sap.ui.core.BusyIndicator.hide()},error:function(e){}})},handleChange:function(e){this.getView().byId("numColegiadoInput").setValue(this.getView().byId("numColegiadoInput").getValue().replace(/\D/g,""))},f_submit:function(){var e=new n({text:"Su solicitud se está realizando. Por favor, espere."});e.open();var t=this.getView(),a=[[t.byId("numColegiadoInput"),false],[t.byId("nombreInput"),false],[t.byId("apellido1Input"),false],[t.byId("apellido2Input"),false],[t.byId("documentoInput"),false],[t.byId("emailInput"),false],[t.byId("tlfInput"),false],[t.byId("especialidadesInput"),true]],i=false;a.forEach(function(e){i=this._validateInput(e)||i},this);if(!i){var o={};o.IdCollegiate=t.byId("numColegiadoInput").getValue();o.Name=t.byId("nombreInput").getValue();o.Surname1=t.byId("apellido1Input").getValue();o.Surname2=t.byId("apellido2Input").getValue();o.PersonalIdType=t.byId("documentoSelect").getSelectedKey();o.PersonalId=t.byId("documentoInput").getValue();o.Email=t.byId("emailInput").getValue();o.Gender=t.byId("generoInput").getSelectedKey();o.Phone=t.byId("tlfInput").getValue();o.PrescriberType=t.byId("prescriberTypeInput").getSelectedKey();o.MedicalToSpecialityNAV=[];var s=t.byId("especialidadesInput").getSelectedKeys();s.forEach(e=>{var t={};t.IdCollegiate=o.IdCollegiate;t.Pernr="12341";t.Speciality=e;o.MedicalToSpecialityNAV.push(t)});r.create("/MedicalRegistrationSet",o,{async:true,success:function(){e.close();l.confirm("El alta ya se ha realizado.\n\nEn breve, recibirá un correo de confirmación.\n\nYa puede realizar prescripción de recetas electrónicas.",{actions:[l.Action.OK],emphasizedAction:l.Action.OK,onClose:function(e){window.close()}})},error:function(t){e.close();var a=t.response.body;a=a.split("<message>");a=a[1];a=a.split("</message>");sap.m.MessageBox.error(a[0],{title:"Error",initialFocus:null})}})}else{e.close();l.alert("Error de validación. Compruebe que todos los campos están rellenos e inténtelo de nuevo.")}},_validateInput:function(e){var t="None";var a=false;var i=e[0].getBinding("value");if(e[1]===true){if(e[0].getSelectedKeys().length<1){t="Error";a=true}}else{try{i.getType().validateValue(e[0].getValue())}catch(e){t="Error";a=true}}e[0].setValueState(t);return a},handleSelectionChange:function(e){var t=e.getParameter("changedItem");var a=e.getParameter("selected");var i="Selected";if(!a){i="Deselected"}},onOpenPopoverDialog:function(){if(!this.oApproveDialog){this.oApproveDialog=new t({type:u.Message,title:"Salir de la aplicación",content:new o({text:"Si no completa el alta en la plataforma REMPe no podrá crear recetas electrónicas, ¿está seguro de que desea salir?"}),beginButton:new a({text:"Si",press:function(){window.close()}.bind(this)}),endButton:new a({type:s.Emphasized,text:"No",press:function(){this.oApproveDialog.close()}.bind(this)})})}this.oApproveDialog.open()}})});
//# sourceMappingURL=Main.controller.js.map